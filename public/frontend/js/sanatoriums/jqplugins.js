AutoComplete=new function(){this.actual_input=null,this.actual_results=null,this.timeout=null,this.init=function(){$('input[data-action="autocomplete"]').each(function(a,b){var c=$(b).parent();$(c).append('<ul data-action="autocomplete-results" class="autocomplete"></ul>'),$(b).on("keydown",function(a){return 38==a.which||40==a.which||"Up"==a.key||"ArrowUp"==a.key||"Down"==a.key||"ArrowDown"==a.key||13==a.which||"Enter"==a.key?(a.stopPropagation(),a.preventDefault(),!1):void 0}).on("keyup",function(a){if(!AutoComplete.actual_input)return!1;if(38==a.which||40==a.which||"Up"==a.key||"ArrowUp"==a.key||"Down"==a.key||"ArrowDown"==a.key){var b=$(AutoComplete.actual_results).find("li"),c=b.length,d=$(AutoComplete.actual_results).find("li.active:first"),e=$(b).index(d);$(b).removeClass("active"),(38==a.which||"Up"==a.key||"ArrowUp"==a.key)&&e>0&&e--,(40==a.which||"Down"==a.key||"ArrowDown"==a.key)&&c-1>e&&e++;var f=$(AutoComplete.actual_results).find("li:eq("+e+")");return $(this).val($(f).attr("data-search")),$(f).addClass("active"),a.stopPropagation(),a.preventDefault(),!1}if(13==a.which||"Enter"==a.key){var g=$(AutoComplete.actual_results).find("li.active:first");return g.length>0&&""!=g.attr("data-search")&&$(this).val($(g).attr("data-search")),$(this).blur(),a.stopPropagation(),a.preventDefault(),!1}if(27==a.which||"Esc"==a.key||"Escape"==a.key){var d=$(AutoComplete.actual_results).find("li.active");d.length>0?($(this).val($(this).attr("data-autocomplete-phrase")),$(d).removeClass("active")):$(this).blur()}if($(this).val()!=$(this).attr("data-autocomplete-phrase")){var h=$(this).val().toLowerCase();$(this).attr("data-autocomplete-phrase",$(this).val());var i=$(this).nextAll('[data-action="search_text_clear"]');if(""==h)$(AutoComplete.actual_results).empty(),$(AutoComplete.actual_results).fadeOut(100),i&&$(i).fadeOut(200);else{if(h.length>1){window.clearTimeout(AutoComplete.timeout);var j=window.autocomplete_url+"?phr="+encodeURIComponent(h);$(AutoComplete.actual_input).attr("data-autocomplete-filter")&&(j=j+"&"+$(AutoComplete.actual_input).attr("data-autocomplete-filter")),AutoComplete.timeout=setTimeout("$(AutoComplete.actual_results).load('"+j+"', null, function() { if($(AutoComplete.actual_input).is(':focus') && $(AutoComplete.actual_results).find('li').length > 0) $(AutoComplete.actual_results).fadeIn(100); else $(AutoComplete.actual_results).fadeOut(100); });",500)}i&&$(i).fadeIn(200)}}}).on("focus",function(){AutoComplete.actual_input=this,AutoComplete.actual_results=$(this).nextAll('[data-action="autocomplete-results"]'),$(AutoComplete.actual_input).attr("data-autocomplete-phrase",""),$(this).trigger("keyup")}).on("blur",function(){$(AutoComplete.actual_results).fadeOut(500),AutoComplete.actual_input=null,AutoComplete.actual_results=null})}),$('[data-action="autocomplete-results"]').on("click","li",function(){var a=$(this).parent().prevAll('[data-action="autocomplete"]');return $(a).val($(this).attr("data-search")).trigger("keyup"),!1})}},$(document).ready(function(){AutoComplete.init()}),function(a){"use strict";a.fn.fitVids=function(b){var c={customSelector:null},d=document.createElement("div"),e=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];return d.className="fit-vids-style",d.innerHTML="&shy;<style>               .fluid-width-video-wrapper {                 width: 100%;                              position: relative;                       padding: 0;                            }                                                                                   .fluid-width-video-wrapper iframe,        .fluid-width-video-wrapper object,        .fluid-width-video-wrapper embed {           position: absolute;                       top: 0;                                   left: 0;                                  width: 100%;                              height: 100%;                          }                                       </style>",e.parentNode.insertBefore(d,e),b&&a.extend(c,b),this.each(function(){var b=["iframe[src*='player.vimeo.com']","iframe[src*='www.youtube.com']","iframe[src*='www.kickstarter.com']","object","embed"];c.customSelector&&b.push(c.customSelector);var d=a(this).find(b.join(","));d.each(function(){var b=a(this);if(!("embed"===this.tagName.toLowerCase()&&b.parent("object").length||b.parent(".fluid-width-video-wrapper").length)){var c="object"===this.tagName.toLowerCase()||b.attr("height")&&!isNaN(parseInt(b.attr("height"),10))?parseInt(b.attr("height"),10):b.height(),d=isNaN(parseInt(b.attr("width"),10))?b.width():parseInt(b.attr("width"),10),e=c/d;if(!b.attr("id")){var f="fitvid"+Math.floor(999999*Math.random());b.attr("id",f)}b.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*e+"%"),b.removeAttr("height").removeAttr("width")}})})}}(jQuery),FloatTip=new function(){this.fadeTime=200,this.init=function(){var a=this;return a.build(),$("body").on("mouseenter click",'[data-action="floattip"]',function(b){return a.show($(b.currentTarget)),!1})},this.build=function(){var a=this;$('[data-action="floattip"]').each(function(b,c){var d=$(c).height(),e=$(c).find('[data-type="floattip-content"]').detach().css({margin:"0 0 "+(d+13)+"px 0"}).append("<em></em>");$("<div>",{id:"floattip_"+b,"class":"floatTip"}).append(e).on("mouseleave click",function(){return a.hide(this),!1}).appendTo(c)})},this.show=function(a){a.find("div.floatTip").fadeIn(this.fadeTime)},this.hide=function(a){$(a).fadeOut(this.fadeTime)}},$(document).ready(function(){FloatTip.init()}),Gallery=new function(){this._activeGallery=null,this.init=function(a){var b=this;$('[data-action="gallery"]').not(".hasGallery").each(function(a,c){$(c).on("click",'[data-action="gallery-prev"]',function(){b._gotoDiff(-1,c)}),$(c).on("click",'[data-action="gallery-next"]',function(){b._gotoDiff(1,c)}),$(c).on("click",'[data-action="gallery-thumbs"] > li',function(){b._goto($(this).index(),c)}),$(c).on("click","a[data-video-url]",function(){var a=$(this).closest("li");return $(a).find("*").hide(),$(a).append('<iframe width="560" height="315" src="'+$(this).attr("data-video-url")+'?autoplay=1&rel=0" frameborder="0" allowfullscreen></iframe>').fitVids(),!1}),$(c).addClass("hasGallery")}),(void 0==a||0>a)&&(a=0),$('[data-action="gallery"]').each(function(c,d){b._activeGallery=d,b._goto(a)}),$("body").unbind("keyup",b._bodyEvent).bind("keyup",{_this:b},b._bodyEvent)},this._bodyEvent=function(a){var b=a.data._this;(37==a.which||"Left"==a.key||"ArrowLeft"==a.key)&&b._gotoDiff(-1),(38==a.which||"Up"==a.key||"ArrowUp"==a.key)&&b._gotoDiff(-11),(39==a.which||"Right"==a.key||"ArrowRight"==a.key)&&b._gotoDiff(1),(40==a.which||"Down"==a.key||"ArrowDown"==a.key)&&b._gotoDiff(11)},this._goto=function(a){var b=this,c=$(b._activeGallery).find('[data-action="gallery-slider"]'),d=$(b._activeGallery).find('[data-action="gallery-thumbs"]'),e=$(b._activeGallery).find('[data-action="gallery-info"]'),f=$(b._activeGallery).find('[data-action="gallery-pager"]'),g=$(c).find("> li:eq("+a+")"),h=$(g).find(".wrapper");$(h).find("span").hide(),$(c).find("> li:visible").length>0?$(c).find("> li:visible").fadeOut(200,function(){$(this).find(".fluid-width-video-wrapper").remove(),$(this).find("*").show(),$(g).fadeIn(200,function(){b._setWrapper(h)})}):$(g).fadeIn(200,function(){b._setWrapper(h)}),e&&($(e).find("> li:visible").hide(),$(e).find("> li:eq("+a+")").show()),d&&($(d).find("> li.active").removeClass("active"),$(d).find("> li:eq("+a+")").addClass("active")),f&&$(f).text(a+1+" / "+$(c).find("> li").length)},this._gotoDiff=function(a){var b=this,c=$(b._activeGallery).find('[data-action="gallery-slider"]'),d=$(c).find("> li:visible").index()+a,e=$(c).find("> li").length-1;d>e&&(d=0),0>d&&(d=e),this._goto(d)},this._setWrapper=function(a){var b=$(a).find("img"),c=function(){var c=$(a).find("span");$(a).css("width",$(b).width()+"px").css("height",$(b).height()+"px"),$(c).fadeIn(500)};$(b).width()>100&&$(b).height()>100?c():$(b).on("load",function(){c()})}},$(document).ready(function(){Gallery.init()}),window.gmapsApiLoaded=!1,$.widget("sanatoriums.gmap",{texts:{ru:{treatment:"Качество<br />лечения"},cs:{treatment:"Kvalita<br />léčení"}},internals:{map:null,infowindow:null,_activeSanMarker:null,bounds:null},options:{lang:"ru",center:null,zoom:null,sanatoriums:null,pois:null,onSanatoriumClick:null},reset:function(){_this=this,this.internals.map.addListener("resize",function(){_this.__setCenterAndZoom()}),google.maps.event.trigger(this.internals.map,"resize")},_create:function(){window.gmapsApiLoaded?this.__init():this.__loadGmapsApi()},__loadGmapsApi:function(){_this=this,$.getScript("https://www.google.com/jsapi",function(){google.load("maps","3",{other_params:"key=AIzaSyBY140ZUF4cjILfCKRjqYgozMdA65AtcWY",callback:function(){window.gmapsApiLoaded=!0,_this.__init()}})})},__init:function(){_this=this;var a=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]}],b={zoom:this.options.zoom,center:this.options.center,zoomControl:!0,mapTypeControl:!0,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE]},scaleControl:!1,streetViewControl:!1,rotateControl:!1,styles:a};this.internals.map=new google.maps.Map(this.element[0],b),this.internals.infowindow=new google.maps.InfoWindow,this.__setSanMarkers(),this.__setPoiMarkers(),this.__setCenterAndZoom()},__setCenterAndZoom:function(){null==this.options.zoom&&null!=this.internals.bounds?this.internals.map.fitBounds(this.internals.bounds):(null!=this.options.zoom&&this.internals.map.setZoom(this.options.zoom),null!=this.options.center?this.internals.map.setCenter(this.options.center):null!=this.internals._activeSanMarker&&this.internals.map.setCenter(this.internals._activeSanMarker.getPosition()))},__setSanMarkers:function(){if(_this=this,this.options.sanatoriums&&!(this.options.sanatoriums.length<1))for(this.internals.bounds=new google.maps.LatLngBounds,idx=0,len=this.options.sanatoriums.length;len>idx;idx++){var a=this.options.sanatoriums[idx],b=new google.maps.LatLng(parseFloat(a.gps_lat),parseFloat(a.gps_lon)),c=new google.maps.Marker({position:b,icon:"/images/sanatoriums/map/sanatorium-"+a.type+".png",map:this.internals.map,san:a});"major"==a.type&&(this.internals._activeSanMarker=c,c.setZIndex(1e3)),c.addListener("mouseover",function(){_this.__openInfowindow(this)}),c.addListener("mouseout",function(){_this.__closeInfowindow()}),c.addListener("click",function(){null==_this.options.onSanatoriumClick?window.location.href=this.san.link:(null!=_this.internals._activeSanMarker&&(_this.internals._activeSanMarker.setIcon("/images/sanatoriums/map/sanatorium-"+_this.internals._activeSanMarker.san.type+".png"),_this.internals._activeSanMarker.setZIndex(100)),this.setIcon("/images/sanatoriums/map/sanatorium-"+this.san.type+"-active.png"),this.setZIndex(1e3),_this.internals._activeSanMarker=this,callByName(_this.options.onSanatoriumClick,this.san))}),this.internals.bounds.extend(b)}},__setPoiMarkers:function(){if(this.options.pois&&!(this.options.pois.length<1))for(idx=0,len=this.options.pois.length;len>idx;idx++){var a=this.options.pois[idx],b=new google.maps.LatLng(parseFloat(a.gps_lat),parseFloat(a.gps_lon));new google.maps.Marker({position:b,icon:"/images/sanatoriums/map/poi-"+a.object_type+".png",map:this.internals.map,title:a.name})}},__openInfowindow:function(a){var b;a.san?(b='<div id="mapInfowindowWrapper"><div id="mapInfowindowHeader"><h2>'+a.san.name+'</h2><em class="stars stars'+a.san.category+'"></em></div>',null!=a.san.treatment&&(b=b+'<p class="treatment"><span>'+this.texts[this.options.lang].treatment+"</span><em> "+a.san.treatment+"</em></p>"),null!=a.san.price1&&(b=b+'<p class="price">'+a.san.price1+"<br />"+a.san.price2+"</p>"),b+="</div>"):b="",this.internals.infowindow.setContent(b),""!=b&&this.internals.infowindow.open(this.internals.map,a)},__closeInfowindow:function(){this.internals.infowindow.close()}}),Viewbox=new function(){this._fadeTime=200,this._body=null,this._lastUrl=null,this.init=function(){var a=this;$("#viewboxView").length>0||(a._body=$("body"),a._build(),$(a._body).on("click","a[data-viewbox]",function(){var b=$(this).attr(""!=$(this).attr("data-viewbox")?"data-viewbox":"href");return a._process(b,$(this).attr("data-viewbox-title"),$(this).attr("data-viewbox-id"),$(this).attr("data-viewbox-callback")),!1}),$(a._body).on("click","ul[data-viewbox] > li",function(){var b=$(this).parent();return a._process($(b).attr("data-viewbox"),$(this).attr("data-viewbox-title"),$(this).index(),$(this).attr("data-viewbox-callback")),!1}))},this._build=function(){var a=this;$("<div>",{id:"viewboxBkg",style:"height:"+$(document).height()+"px;"}).hide().on("click",function(){return a._hide(),!1}).appendTo(a._body);var b=$("<div>",{id:"viewboxView"}).hide();$("<div>",{id:"viewboxLoading"}).appendTo(b);var c=$("<div>",{id:"viewboxContent"});$(c).on("click","#viewboxCloseBtn",function(){return a._hide(),!1}),$(c).appendTo(b),$(b).appendTo(a._body)},this._process=function(a,b,c,d){var e=this;if(e._lastUrl!=a)if(e._showLoading(),e._show(),this._isExternalLink(a)){var f="";void 0!=b&&""!=b&&(f=f+'<h2 id="viewboxTitle">'+b+"</h2>"),f=f+'<span id="viewboxCloseBtn" class="hidden"></span><div id="viewboxFrameWrapper"><iframe width="560" height="315" src="'+a+'" frameborder="0"></iframe></div>',$("#viewboxContent").html(f).fitVids(),e._showContent(c),e._lastUrl=""}else $.get(a,function(b){var f=b.indexOf("<body");f>-1&&(b=b.substring(b.indexOf(">",f)+1,b.indexOf("</body>")));var g=$("<div/>").append(b).find("div:first");$("#viewboxContent").html(g.html()),e._showContent(c),e._lastUrl=a,d&&callByName(d)});else e._show(),e._showContent(c),d&&callByName(d)},this._show=function(){var a=this;$("#viewboxBkg,#viewboxView").fadeIn(a._fadeTime),$(a._body).bind("keyup",{_this:a},a._bodyEvent)},this._hide=function(){var a=this;$("#viewboxContent .fluid-width-video-wrapper").remove(),$('#viewboxContent [data-action="gallery-slider"] > li *:hidden').show(),$("#viewboxBkg,#viewboxView").fadeOut(a._fadeTime),$(a._body).unbind("keyup",{_this:a},a._bodyEvent)},this._showContent=function(a){Gallery.init(a),$("#viewboxLoading").hide(),$("#viewboxContent").show(),$("#viewboxCloseBtn").removeClass("hidden").show()},this._showLoading=function(){$("#viewboxContent").hide().empty(),$("#viewboxLoading").show()},this._bodyEvent=function(a){var b=a.data._this;(27==a.which||"Esc"==a.key||"Escape"==a.key)&&b._hide()},this._isExternalLink=function(a){var b=a.indexOf("//");if(-1===b&&"/"==a.substring(0,1))return!1;var c=(b>-1?a.split("/")[2]:a.split("/")[0]).split(":")[0];return c!==location.host}},$(document).ready(function(){Viewbox.init()});